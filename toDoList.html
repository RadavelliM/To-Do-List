<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>TO DO LIST</title>

    <style>
        @import url('https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap');

        :root {
            --primary-color: rgb(17, 86, 102);
            --primary-color-darker: rgb(9, 48, 56);
        }

        body {
            margin: 0;
            padding: 0;
            background: #4f3ffc;
            background: linear-gradient(148deg, rgba(79, 63, 252, 1) 0%, rgba(87, 147, 199, 1) 50%, rgba(147, 83, 237, 1) 100%);
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-size: cover;

            font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
            font-size: 1.3em;
            line-height: 1.5em;

        }

        * {
            box-sizing: border-box;
        }

        *::selection {
            background-color: lightblue;
        }

        h1,
        h4 {
            text-align: center;
        }

        .container {
            width: 60vw;
            margin: 50px auto;
            padding: 20px;

            background: #fff;
            border-radius: 10px;
            border: 3px solid rgb(98, 0, 255);

            word-break: break-word;
        }

        #taskWarning {
            text-align: center;
            color: red;
            user-select: none;
        }

        .generateDiv {
            display: flex;
            position: relative;
            background-color: rgb(0, 179, 255);
            width: 55vw;
            margin-bottom: 20px;
            border-radius: 10px;
        }

        .addTask {
            text-align: center;
            position: relative;
            user-select: none;
        }

        .addTaskButton {
            background-color: lightblue;
            border-radius: 15px;
            border-color: rgb(0, 174, 255);
            position: relative;
            margin-left: -45px;
            cursor: pointer;
            height: 50px;
        }

        .taskLocal {
            margin-top: 15px;
            display: grid;
            place-content: center;
        }

        .removeTaskButton {
            background-color: transparent;
            border: none;
            color: red;
            font-size: 30px;
            margin-left: 30px;
            cursor: pointer;
            user-select: none;
        }

        .editTaskButton {
            background-color: transparent;
            color: rgb(255, 255, 255);
            border: none;
            font-size: 20px;
            cursor: pointer;
            user-select: none;
            z-index: 8;
        }

        .alterTaskButton {
            background-color: lightblue;
            border-radius: 15px;
            border-color: rgb(0, 174, 255);

            width: 70px;
            height: 50px;

            margin-top: 90px;
            margin-left: 100px;
            z-index: 9;
        }

        #alterTask {
            margin-top: 90px;
            margin-left: -300px;
        }

        .triangle {
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
            width: 20px;
            height: 20px;
            background-color: black;

            margin-top: 70px;
            margin-left: -120px;
            z-index: 9;
        }

        input {
            border-radius: 20px;
            border-color: rgb(0, 174, 255);
            margin-bottom: 10px;
            width: 300px;
            height: 50px;

        }

        label {
            position: absolute;
            margin-left: -290px;
            transform: translateY(10px);
            color: #848484;
            transition: 1s;
        }

        input:valid+label,
        input:focus+label {
            position: absolute;
            transform: translateY(-15px);
            padding: 0px 5px 0px;
            background-color: white;
            transition: 1s;
        }

        input:-webkit-autofill,
        input:-webkit-autofill:hover,
        input:-webkit-autofill:focus,
        input:-webkit-autofill:active {

            -webkit-box-shadow: 0 0 0 1000px white inset !important;
            -webkit-text-fill-color: black !important;
        }

        ::-webkit-scrollbar {
            background-color: rgb(179, 0, 255);
        }

        ::-webkit-scrollbar-thumb {
            background-color: white;
            border-radius: 15px;
        }

        /* ======================================== MEDIA QUERY =========================================== */

        @media (max-width: 480px) {
            .container {
                width: 80vw;
            }

            .generateDiv {
                width: 50vw;
            }

            input {
                width: 160px;
            }

            label {
                margin-left: -150px;
            }
        }
    </style>
</head>

<body>

    <div class="container">
        <div class="info">
            <h1>TO DO LIST</h1>
            <h4>Coloque no campo abaixo suas tarefas para fazer:</h4>
            <p id="taskWarning"></p>
        </div>

        <div class="addTask">
            <input required type="text" name="addTaskInput" id="addTaskInput">
            <label for="addTaskInput">Tarefa</label>
            <button title="Adicionar Tarefa" class="addTaskButton">ADICIONAR</button>
        </div>

        <div class="taskLocal"></div>
    </div>
    <script>
        function embedGlobalScopeToDoList() {

            const taskLocal = document.querySelector('.taskLocal');
            const addTaskButton = document.querySelector('.addTaskButton');
            const taskWarning = document.querySelector("#taskWarning");
            let taskCount = 0;

            function eventListenerActivateFunctions() {
                addTaskButton.addEventListener('click', (e) => {
                    const addTaskInput = document.querySelector('#addTaskInput').value;
                    if (!addTaskInput) {
                        taskWarning.innerText = "Campo não pode ser vazio!";
                        return;
                    }
                    createTask(addTaskInput);
                })
                document.addEventListener('keypress', (e) => {
                    const addTaskInput = document.querySelector('#addTaskInput').value;

                    // e.keyCode === 13
                    if (e.key === 'Enter') {
                        if (!addTaskInput) {
                            taskWarning.innerText = "Campo não pode ser vazio!";
                            return;
                        }
                        createTask(addTaskInput);
                    }
                })
            }
            eventListenerActivateFunctions();

            function createTask(task) {

                const clearInput = document.querySelector('#addTaskInput');
                clearInput.value = "";

                taskWarning.innerText = '';
                taskCount++

                const generateULtask = document.createElement('ul');
                const generateLItask = document.createElement('li');

                const generateEditTaskButton = document.createElement('button');
                const generateRemoveTaskButton = document.createElement('button');

                const generateDIVtask = document.createElement('div');

                generateEditTaskButton.setAttribute('class', 'editTaskButton');
                generateEditTaskButton.setAttribute('title', 'Editar Tarefa');

                generateRemoveTaskButton.setAttribute('class', "removeTaskButton");
                generateRemoveTaskButton.setAttribute('title', "Apagar Tarefa");

                generateDIVtask.setAttribute('class', 'generateDiv');
                generateDIVtask.classList.add(`task${taskCount}`);
                
                generateLItask.innerText = task;
                generateRemoveTaskButton.innerText = "X";
                generateEditTaskButton.innerText = "Editar";

                generateULtask.appendChild(generateLItask);
                generateULtask.appendChild(generateEditTaskButton);
                generateULtask.appendChild(generateRemoveTaskButton);

                generateDIVtask.appendChild(generateULtask);

                taskLocal.appendChild(generateDIVtask);

                saveTask();
            }

            function createEditTaskButton() {
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('editTaskButton')) {

                        const getFirstElement = e.target.parentElement;
                        const getSecondElement = getFirstElement.parentElement;

                        const getEditTaskButton = document.querySelector('.editTaskButton');
                        getEditTaskButton.disabled = true;

                        const generateDIVtriangle = document.createElement('div');
                        const generateAlterTaskButton = document.createElement('button');
                        const generateInputEditTask = document.createElement('Input');

                        generateDIVtriangle.setAttribute('class', 'triangle')

                        generateInputEditTask.setAttribute('id', 'alterTask')
                        generateInputEditTask.setAttribute('class', 'edit')

                        generateAlterTaskButton.setAttribute('class', 'alterTaskButton')
                        generateAlterTaskButton.innerText = "Salvar"

                        getSecondElement.appendChild(generateDIVtriangle);
                        getSecondElement.appendChild(generateAlterTaskButton);
                        getSecondElement.appendChild(generateInputEditTask);

                        editTask();
                        verifyBlurOfEditTaskInput();
                    }
                })
            }
            createEditTaskButton()

            function editTask() {
                const getAlterTaskInput = document.querySelector('#alterTask').value;
                const getAlterTaskButton = document.querySelector('.alterTaskButton').addEventListener('click', (e) => {
                    if (!getAlterTaskInput) {
                        taskWarning.innerText = "Campo não pode ser vazio!";
                        return;
                    }
                    createTask(getAlterTaskInput);

                    const getFirstElement = e.target.parentElement.remove();
                    saveTask();
                })
                document.addEventListener('keypress', (e) => {
                    if (e.key === "Enter") {
                        if (!getAlterTaskInput) {
                            taskWarning.innerText = "Campo não pode ser vazio!";
                            return;
                        }
                        createTask(getAlterTaskInput);

                        const getFirstElement = e.target.parentElement.remove();
                        saveTask();
                    }
                })
            }

            function verifyBlurOfEditTaskInput() {
                document.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('editTaskButton') && !e.target.classList.contains('edit')) {
                        try {
                            const getTriangle = document.querySelector('.triangle');
                            const getAlterTaskInput = document.querySelector('#alterTask');
                            const getAlterTaskButton = document.querySelector('.alterTaskButton');

                            const getEditTaskButton = document.querySelector('.editTaskButton');
                            getEditTaskButton.disabled = false;

                            getTriangle.remove();
                            getAlterTaskInput.remove();
                            getAlterTaskButton.remove();
                        } catch (e) {}
                    }

                })
            }

            function removeTask() {
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('removeTaskButton')) {
                        const getFirstElement = e.target.parentElement;
                        const getSecondElement = getFirstElement.parentElement.remove();
                        saveTask();
                    }
                })
            }
            removeTask()

            function saveTask() {
                const getAllTasks = taskLocal.querySelectorAll('li');
                const taskList = [];

                for (let task of getAllTasks) {
                    let taskText = task.innerText;
                    taskText = taskText.replace(',', '');

                    taskList.push(taskText);
                }
                const saveTaskInJSONformat = JSON.stringify(taskList);
                localStorage.setItem('taskSaved', saveTaskInJSONformat);
            }

            function loadSavedTasksInJSON() {
                const getSavedTasksInJSONformat = localStorage.getItem('taskSaved');
                const convertTaskListToArray = JSON.parse(getSavedTasksInJSONformat);

                for (let task of convertTaskListToArray) {
                    createTask(task);
                }

            }
            loadSavedTasksInJSON();
        }
        embedGlobalScopeToDoList();
    </script>
</body>

</html>
